<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayuda</title>
    <style>
    body{
        height: 100vh;
        display: flex;
    }
        canvas{
            width: 50%;
            margin: auto;
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script>
        class Over{
            constructor(params, obj){
                this.canvas = params.canvas;
                this.ctx = params.ctx;
                this.obj = obj;
                this.scene = 0;
                this.monsters = {
                    monstruo1:{
                        active:false,
                        x:-600,
                        y:-10,
                        dialog:[
                        "te quiro mucho uwu besame", 
                        "maldito miserable", 
                        "como te atrevez a hablarme asi", 
                        "MUERE!!!!!!!!!"],
                        scene:() => {
                            if(this.monsters["monstruo1"].x != 40){
                                this.monsters["monstruo1"].x +=10
                        }
                        else if(this.monsters["monstruo1"].x == 10 && this.monsters["monstruo1"].y == 50){
                            this.monsters["monstruo1"].x += 2
                        }
                        else{
                            this.monsters["monstruo1"].active = true
                        }
                        }
                    },
                    monstruo2:{
                        active:false,
                        x:600,
                        y:10,
                        dialog:[
                        "detente animal",
                        "no te lo permitire miserable", 
                        "tienes que ayudarme ",
                        "hay algo raro", 
                        "tienes que ir a la fortaleza de tu madre"],
                        scene:() => {
                            if(this.monsters["monstruo2"].x >= 100){
                                this.monsters["monstruo2"].x -=10
                            }
                            else if(this.monsters["monstruo2"].x <= 100 && this.monsters["monstruo2"].y >= 50){
                                this.monsters["monstruo2"].y -= 2
                            }
                            else{
                                this.monsters["monstruo2"].active = true
                            }
                        }
                        },
                        dialogo:{
                            active:true,
                                dialog:[
                            "Los huevones se fueron a la fortaleza",
                            "Descubrieron algo increible", 
                            "La muerte se olia",
                            "Las calamidades de la muerte", 
                            "*AAAAAAAHHHHHHHHHHH*"],
                            scene:() => {
                                this.monsters["dialogo"].active = true
                            }
                            }
                }
                this.textIndex = 0;
                this.text = ""
                this.dialog = 0;
                this.dialogX = 100;
            }
            drawButton(){
                this.ctx.fillStyle = "blue";
                this.ctx.fillRect(100, 100, 150, 50);
                this.ctx.font = "20px Arial";
                this.ctx.fillStyle = "white";
                this.ctx.fillText("hola como estas", 100 + 150/2, 100 + 50/2);

            }
            generateMonster(monster){
                this.drawButton()
                        this.monsters[monster].scene()
                        if(this.monsters[monster].active == true){
                            if(this.monsters[monster].dialog.length <= this.dialog){
                                this.scene +=1
                                this.textIndex = 0;
                                this.dialog = 0;
                            }
                            let arr = this.monsters[monster].dialog
                            let texto = arr[this.dialog].split("");
                            if(texto.length > this.textIndex){
                                this.text += texto[this.textIndex]
                            }
                            else if (texto.length == this.textIndex){
                                setTimeout(() => {
                                    this.text = ""
                                    this.dialog += 1;
                                    this.textIndex = 0;  
                                }, 2000)
                            }
                            this.ctx.font = "bold 30px serif";
                            this.ctx.fillStyle = "rgba(0,0,0,0.7)";
                            
                            this.ctx.fillRect(0,this.canvas.height - 200,this.canvas.width,200)
                            this.ctx.fillStyle = "yellow";
                            this.ctx.fillText(this.text ,20,this.canvas.height - this.dialogX );
                            this.textIndex +=1;
                        
                        }
                    
            }
            drawMonster(param, monster){
                let image = new Image();
                let count = 0;
                if(monster != "dialogo"){
                    image.onload = () => {
                        image.height;
                        image.width;
                        
                            this.ctx.drawImage(image, this.monsters[monster].x, this.monsters[monster].y,image.width,image.height);
                       
                        
                        count++
                        this.generateMonster(monster)
                        }
                     image.src = param  
                 }   
                 else{
                    this.generateMonster(monster)
                 
                 }
                 
            }
            draw(){
            const a = () => {
                let image = new Image();
                this.ctx.clearRect( 0, 0,image.width,image.height);
                        image.onload = () => {
                            this.ctx.canvas.width = image.width;
                            this.ctx.canvas.height = image.height;
                            this.ctx.drawImage(image, 0, 0,image.width,image.height);
                            if(this.scene == 0){
                                this.drawMonster("Real-Monster-PNG-Clipart.png", "monstruo1" )
                            }
                            else if(this.scene == 1){
                                this.drawMonster("pngegg.png", "monstruo2")
                            }
                            else if (this.scene == 2){
                                this.drawMonster("", "dialogo");
                            }
                        }
                    requestAnimationFrame(a)
                    image.src = this.obj.src;
                }
                requestAnimationFrame(a)
            }
            init(){
                this.draw()
                this.canvas.addEventListener("click", (event) =>{
                var rect = this.canvas.getBoundingClientRect();
                var x = event.clientX - rect.left;
                var y = event.clientY - rect.top;
                if (x > 100 && x < 250 && y > 100 && y < 150) {
                
                alert("Button clicked!");
                }
            });
            }
        }
        let canvas = document.getElementById("canvas")
        const over = new Over({canvas:canvas, ctx:canvas.getContext("2d")}, {src:"shutterstock_96456725.jpg"})
        over.init()
    </script>
</body>
</html>